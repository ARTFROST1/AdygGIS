# üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ª–æ–≥–∏–∫–∞

**–î–∞—Ç–∞:** 6 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π](#–æ–±–∑–æ—Ä-—Ñ—É–Ω–∫—Ü–∏–π)
2. [–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∏ –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞](#—Ä–∞–∑–Ω–∏—Ü–∞-–º–µ–∂–¥—É-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π-–∏-–æ—á–∏—Å—Ç–∫–æ–π-–∫—ç—à–∞)
3. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
4. [UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#ui-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
5. [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏)

---

## üéØ –û–±–∑–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏:

### 1. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ** (Delta Sync)
- –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å Supabase —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ë—ã—Å—Ç—Ä–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–æ–±—ã—á–Ω–æ —Å–µ–∫—É–Ω–¥—ã)
- –ù–µ —É–¥–∞–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω–æ–µ

### 2. **–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à** (Full Clear + Full Sync)
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (Room)
- –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Memory + Disk)
- –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç timestamp —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å Supabase —Å –Ω—É–ª—è

---

## ü§î –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∏ –æ—á–∏—Å—Ç–∫–æ–π –∫—ç—à–∞

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (Delta Sync)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø (DELTA SYNC)                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                         ‚îÇ
‚îÇ  1. –ü–æ–ª—É—á–∏—Ç—å lastSyncTimestamp –∏–∑ preferences          ‚îÇ
‚îÇ  2. –ó–∞–ø—Ä–æ—Å–∏—Ç—å —É Supabase:                              ‚îÇ
‚îÇ     - Attractions –≥–¥–µ updated_at > lastSyncTimestamp   ‚îÇ
‚îÇ     - Tombstones (—É–¥–∞–ª—ë–Ω–Ω—ã–µ) > lastSyncTimestamp       ‚îÇ
‚îÇ  3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:                               ‚îÇ
‚îÇ     - Upsert –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ/–Ω–æ–≤—ã–µ (preserving favorites)  ‚îÇ
‚îÇ     - Delete –ø–æ tombstones                             ‚îÇ
‚îÇ  4. –û–±–Ω–æ–≤–∏—Ç—å lastSyncTimestamp                         ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  –†–µ–∑—É–ª—å—Ç–∞—Ç:                                            ‚îÇ
‚îÇ  ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞                      ‚îÇ
‚îÇ  ‚úÖ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ                                ‚îÇ
‚îÇ  ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –≤ –∫—ç—à–µ                        ‚îÇ
‚îÇ  ‚ö° –ë—ã—Å—Ç—Ä–æ (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)                          ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–≥–¥–∞ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –º–µ—Å—Ç

### –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ (Full Clear + Full Sync)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –û–ß–ò–°–¢–ö–ê –ö–≠–®–ê (FULL CLEAR + FULL SYNC)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                         ‚îÇ
‚îÇ  1. –û—á–∏—Å—Ç–∏—Ç—å Room database (–≤—Å–µ attractions)           ‚îÇ
‚îÇ  2. –û—á–∏—Å—Ç–∏—Ç—å Image Cache:                              ‚îÇ
‚îÇ     - Memory Cache (25% RAM)                           ‚îÇ
‚îÇ     - Disk Cache (250MB)                               ‚îÇ
‚îÇ  3. –°–±—Ä–æ—Å–∏—Ç—å lastSyncTimestamp (‚Üí null)                ‚îÇ
‚îÇ  4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –ü–û–õ–ù–£–Æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:                    ‚îÇ
‚îÇ     - –ü–æ–ª—É—á–∏—Ç—å –í–°–ï attractions —Å Supabase              ‚îÇ
‚îÇ     - –°–æ–∑–¥–∞—Ç—å –∑–∞–Ω–æ–≤–æ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î                      ‚îÇ
‚îÇ     - –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è                        ‚îÇ
‚îÇ  5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π lastSyncTimestamp                 ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  –†–µ–∑—É–ª—å—Ç–∞—Ç:                                            ‚îÇ
‚îÇ  ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ                            ‚îÇ
‚îÇ  ‚úÖ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ                         ‚îÇ
‚îÇ  ‚ö†Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å–±—Ä–æ—à–µ–Ω–æ                                 ‚îÇ
‚îÇ  ‚ö†Ô∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–Ω–æ–≤–æ                 ‚îÇ
‚îÇ  üêå –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (–ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)                        ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –¥–∞–Ω–Ω—ã–º–∏ (corruption, inconsistency)
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î
- –ï—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞—Å—Ç—Ä—è–ª–∞

---

## üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### SettingsViewModel

#### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```kotlin
/**
 * Perform delta sync with Supabase
 * –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
 */
fun performSync() {
    if (_isSyncing.value) return
    viewModelScope.launch {
        _isSyncing.value = true
        try {
            dataSyncUseCase.syncData().collect { progress ->
                _syncProgress.value = progress

                if (progress is SyncProgress.Completed || progress is SyncProgress.Error) {
                    loadSyncInfo()
                    loadLastSyncTimestamp()
                }
            }
        } finally {
            _isSyncing.value = false
        }
    }
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `_isSyncing = true`
2. –í—ã–∑—ã–≤–∞–µ—Ç `dataSyncUseCase.syncData()` (delta sync)
3. –°–ª–µ–¥–∏—Ç –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º —á–µ—Ä–µ–∑ `SyncProgress`
4. –û–±–Ω–æ–≤–ª—è–µ—Ç timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
5. –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥ `_isSyncing = false`

#### 2. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

```kotlin
/**
 * Clear all cache and perform full sync from Supabase
 * –û—á–∏—â–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (Room + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å –Ω—É–ª—è
 */
fun clearCacheAndSync() {
    viewModelScope.launch {
        try {
            _isClearing.value = true
            
            // 1. Clear Room database
            attractionDao.deleteAll()
            
            // 2. Clear image caches (memory + disk)
            imageCacheManager.clearAllCache()
            
            // 3. Clear preferences (reset sync timestamp)
            cacheManager.clearAllCache()
            
            // 4. Perform full sync from Supabase
            val success = dataSyncUseCase.forceRefresh()
            _syncProgress.value = if (success) {
                SyncProgress.Completed("Data refreshed successfully")
            } else {
                SyncProgress.Error("Failed to refresh data")
            }

            loadSyncInfo()
            loadLastSyncTimestamp()
        } catch (e: Exception) {
            Timber.e(e, "Failed to clear cache and sync")
        } finally {
            _isClearing.value = false
        }
    }
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `_isClearing = true`
2. –û—á–∏—â–∞–µ—Ç Room database (–≤—Å–µ attractions)
3. –û—á–∏—â–∞–µ—Ç –∫—ç—à –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ø–∞–º—è—Ç—å + –¥–∏—Å–∫)
4. –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç sync timestamp –≤ preferences
5. –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (`dataSyncUseCase.forceRefresh()`)
6. –û–±–Ω–æ–≤–ª—è–µ—Ç `SyncProgress`/SyncInfo
7. –û–±–Ω–æ–≤–ª—è–µ—Ç timestamp
8. –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥ `_isClearing = false`

---

## üé® UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### SettingsScreen

```kotlin
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
SettingsItem(
    icon = Icons.Default.Sync,
    title = "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ",
    subtitle = syncSubtitle,  // "–ü–æ—Å–ª–µ–¥–Ω—è—è: 06.01.2026 15:30" –∏–ª–∏ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è..."
    onClick = {
        if (!isSyncing) {
            viewModel.performSync()
            Toast.makeText(context, "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞", Toast.LENGTH_SHORT).show()
        }
    },
    enabled = !isSyncing && uiState.isOnline
)

// –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
SettingsItem(
    icon = Icons.Default.DeleteOutline,
    title = "–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à",
    subtitle = if (isClearing) "–û—á–∏—Å—Ç–∫–∞..." else "–ó–∞–Ω—è—Ç–æ: $cacheSize",
    onClick = {
        if (!isClearing) {
            // Show confirmation dialog
            AlertDialog.Builder(context)
                .setTitle("–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à?")
                .setMessage("–≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –¥–∞–Ω–Ω—ã–µ. " +
                           "–ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?")
                .setPositiveButton("–û—á–∏—Å—Ç–∏—Ç—å") { _, _ ->
                    viewModel.clearCacheAndSync()
                    Toast.makeText(context, "–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω—ã", 
                                  Toast.LENGTH_SHORT).show()
                }
                .setNegativeButton("–û—Ç–º–µ–Ω–∞", null)
                .show()
        }
    },
    enabled = !isClearing && uiState.isOnline
)
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è UI

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ |
|-----------|---------------|--------------|
| **Idle** | "–ü–æ—Å–ª–µ–¥–Ω—è—è: DD.MM.YYYY HH:MM" | "–ó–∞–Ω—è—Ç–æ: X.X –ú–ë" |
| **In Progress** | "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è..." | "–û—á–∏—Å—Ç–∫–∞..." |
| **Disabled** | –ö–æ–≥–¥–∞ `isSyncing == true` –∏–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ | –ö–æ–≥–¥–∞ `isClearing == true` –∏–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ |

---

## üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**–°–∏—Ç—É–∞—Ü–∏—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤ Supabase

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä—ã—Ç—å –ù–∞—Å—Ç—Ä–æ–π–∫–∏
2. –ù–∞–∂–∞—Ç—å "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"
3. –£–≤–∏–¥–µ—Ç—å "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è..." ‚Üí "–ü–æ—Å–ª–µ–¥–Ω—è—è: [—Å–µ–π—á–∞—Å]"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–æ–≤—ã–µ/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –ø–æ—è–≤—è—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ
- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ –∫—ç—à–µ
- –ë—ã—Å—Ç—Ä–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∞–Ω–Ω—ã–º–∏

**–°–∏—Ç—É–∞—Ü–∏—è:** –ö–∞—Ä—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –º–µ—Å—Ç–∞

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä—ã—Ç—å –ù–∞—Å—Ç—Ä–æ–π–∫–∏
2. –ù–∞–∂–∞—Ç—å "–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à"
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤ –¥–∏–∞–ª–æ–≥–µ
4. –£–≤–∏–¥–µ—Ç—å "–û—á–∏—Å—Ç–∫–∞..." ‚Üí "–ó–∞–Ω—è—Ç–æ: 0.0 –ú–ë"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —Å–±—Ä–æ—à–µ–Ω–æ (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω–æ–≤–æ)
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ
- –î–æ–ª—å—à–µ (–º–∏–Ω—É—Ç–∞-–¥–≤–µ)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞

**–°–∏—Ç—É–∞—Ü–∏—è:** –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –º–∞–ª–æ –º–µ—Å—Ç–∞, –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∫—ç—à –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö ("–ó–∞–Ω—è—Ç–æ: 250 –ú–ë")
2. –ù–∞–∂–∞—Ç—å "–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à"
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
4. –£–≤–∏–¥–µ—Ç—å "–ó–∞–Ω—è—Ç–æ: 2.5 –ú–ë" (—Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ ~250 –ú–ë –º–µ—Å—Ç–∞
- –î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ offline-first

### –†–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

–û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ **—Ç—Ä–µ–±—É—é—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç** –∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã offline:
```kotlin
enabled = !isSyncing && uiState.isOnline  // –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
enabled = !isClearing && uiState.isOnline // –î–ª—è –æ—á–∏—Å—Ç–∫–∏
```

**–ü–æ—á–µ–º—É?**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ Supabase –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ ‚Üí –Ω—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚Üí –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- –ë–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –∫—ç—à–µ–º (offline-first)

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

| –û–ø–µ—Ä–∞—Ü–∏—è | –ò–∑–±—Ä–∞–Ω–Ω–æ–µ |
|----------|-----------|
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (preserved) |
| –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ | ‚ùå –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è |

**–ü–æ—á–µ–º—É —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ?**
- –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ —É–¥–∞–ª—è–µ—Ç –í–°–Æ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î
- –≠—Ç–æ –ø–æ–ª–Ω—ã–π reset –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –¥–∞–Ω–Ω—ã–º–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥—ë–Ω –≤ –¥–∏–∞–ª–æ–≥–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –õ–æ–≥–∏ –≤ Logcat

```kotlin
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
üîÑ DataSyncManager: Starting Supabase sync...
‚úÖ Sync completed: +5 ~12 -2

// –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
üóëÔ∏è Starting cache clear and full sync...
üóëÔ∏è Clearing Room database...
üóëÔ∏è Clearing image caches...
üóëÔ∏è Resetting sync timestamp...
üì° Starting full sync from Supabase...
‚úÖ Cache clear and full sync completed
```

### UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

- **Progress**: Spinner –≤ subtitle –≤–æ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏
- **Timestamp**: "–ü–æ—Å–ª–µ–¥–Ω—è—è: DD.MM.YYYY HH:MM"
- **Cache size**: "–ó–∞–Ω—è—Ç–æ: X.X –ú–ë"
- **Disabled state**: –°–µ—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –∫–æ–≥–¥–∞ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–ª–∏ –∏–¥—ë—Ç –æ–ø–µ—Ä–∞—Ü–∏—è

---

## üéØ –í—ã–≤–æ–¥—ã

### –ó–∞—á–µ–º –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏?

–•–æ—Ç—è –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∏—Ç–æ–≥–µ –æ–±–Ω–æ–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ —Å Supabase, –æ–Ω–∏ —Ä–µ—à–∞—é—Ç **—Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏**:

| –ê—Å–ø–µ–∫—Ç | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ |
|--------|---------------|--------------|
| **–¶–µ–ª—å** | –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ | –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã + –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚ö° –ë—ã—Å—Ç—Ä–æ (—Å–µ–∫—É–Ω–¥—ã) | üêå –ú–µ–¥–ª–µ–Ω–Ω–æ (–º–∏–Ω—É—Ç—ã) |
| **–¢—Ä–∞—Ñ–∏–∫** | üì± –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (delta) | üì∂ –ë–æ–ª—å—à–æ–π (full) |
| **–ò–∑–±—Ä–∞–Ω–Ω–æ–µ** | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è | ‚ùå –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è |
| **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** | ‚úÖ –û—Å—Ç–∞—é—Ç—Å—è | ‚ùå –£–¥–∞–ª—è—é—Ç—Å—è |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** | –†–µ–≥—É–ª—è—Ä–Ω–æ | –†–µ–¥–∫–æ (–ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö) |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ":**
- –ö–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–µ—Å—Ç –≤ Supabase
- –ö–æ–≥–¥–∞ —Ö–æ—Ç–∏—Ç–µ —É–≤–∏–¥–µ—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à":**
- –ü—Ä–∏ —Å—Ç—Ä–∞–Ω–Ω–æ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Å—Ö–µ–º—ã
- –ï—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ò—Ç–æ–≥:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ - —Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤! üéØ
